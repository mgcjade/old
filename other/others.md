# 2024.6.1 T1换防——题解
### 一、题意
在一数轴上有 $n$ 个点，其中第 $i$ 个点（$i>1$）在 $p_{i-1}$ 上。这些点上有 $n+1$ 支军队，其中编号为 $i$ 的军队在第 $i$ 个点，编号为 $n+1$ 的军队在一号点。现在想要把第 $i$ 支军队移动到第 $w_i$ 个点上：移动时要保证被移动的军队所在点上至少有两支军队才可将其移动到任意一点上。要你求玩成这些操作的最少合法移动距离。

---

### 二、思路

首先考虑将 $i$ 与 $w_i$ 连一条有向边，那这张图就会由几个环组成。其中：

1.对于长度为1的环（一个点）：不需要移动操作，可忽略。
2.对于长度大于1的环，易得以下移动方式即为最优解之一：当其中一个军队 $i$ 可以进行合法移动时，将其移动至 $w_i$ ，之后再将在第 $w_i$ 支军队移动至 $w_{w_i}$...

**所以，在一个环内，只要其中一个点可进行合法移动，那么整个环就可以完成“换防”操作**

根据此结论，可将样例分为两个环： $1 \rightarrow 3 \rightarrow 2 \rightarrow 1$ 与 $4 \rightarrow 5 \rightarrow 4$ 

考虑如何做到整体最优： 

假设有一个环：  $1 \rightarrow 4 \rightarrow 7 \rightarrow 1$根据上面结论，我们第一步可以从 $1$ 走到   $4$，这的确是最优解，但是我们也可以这样走$1 \rightarrow 2 \rightarrow 3 \rightarrow 4$ 。我们发现这样走也是最优的，而且对比原来还有一个优点：中间的$2、3$在这个过程中会在某个时间下处于可移动状态。也就是说如果$2、3$是在另一些环内，我们就可以顺便把它们也整理了。

而我们将这种方法推广至整个环，事情就会变成这样：**对每个编号最小的点为 $l$ ,最大的为 $r$ 的环，这种走法可以保证对于每个$i(l \leq i \leq r)$ 都可以在这个过程中在某个时间点处于可移动状态。**

那我们的环就可以变成一个**有左右端点的区间**。以样例为例,两个环分别为：$(1,3)$ , $(4,5)$ 。这时，我们可以发现对于两个环 $(l_1,r_1)$ , $(l_2,r_2)$ ,只要它们满足 $l_1 < l_2 < r_1 < r_2$ ,那么第二个环中的某一个点在第一个环整理的过程中就会处于可移动状态（即我们可以顺便把第二个环也整理了）。

所以我们可以先按左端点 $l$ 从小到大排序。那么对于一个左端点 $r_i$ ,只要其满足 $l_i < \max(r_{i-1},r_{i-2}\dots r_1)$ 那么它就可以在前面整理的过程中被顺便整理，可忽略不计。

那对于像样例中那两个没有交集的区间$(l_1<r_1<l_2<r_2)$呢？我们可以这样：因为在整理前面的过程中，$r_2$ 在某一时间点会处于可移动状态。这时，我们就可以将编号为 $r_1$ 的军队调到 $l_2$ 那里，整理后面，之后再调回去，总共会多花$2*(w_{l_2}-w_{r_1})$，之后就是以此类推。最后加上从第一个点到 $l_1$ 的距离即可。
